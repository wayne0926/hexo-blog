(function(window){var MyScroll=function(config){var that=this;defaultConfig={"showBar":true,"color":"rgb(10, 116, 218)","height":"3px","debug":false,"event":[]};var mergeConfig=this.config=this.extend(config,defaultConfig);this.event=mergeConfig.event;if(mergeConfig.showBar){this.loadBar()}this.preHeight=this.getScrollTop();this.nextHeight=this.getScrollTop();var t;window.onscroll=function(){var height=that.getClientHeight(),theight=that.getScrollTop(),rheight=that.getScrollHeight(),bheight=rheight-theight-height;var per=(theight/(theight+bheight)).toFixed(4)*100+"%";if(that.config.showBar){document.getElementById("progressBar").style.width=per}if(that.config.debug){document.getElementById("debugShow").innerHTML="此时浏览器可见区域高度为："+height+"<br />此时文档内容实际高度为："+rheight+"<br />此时滚动条距离顶部的高度为："+theight+"<br />此时滚动条距离底部的高度为："+bheight}that.preHeight=that.nextHeight;that.nextHeight=theight;that.checkEvent()}};MyScroll.prototype.extend=function(p1,p2){var p=(function loop(p1,p2){var p={};for(var item in p2){if(typeof p2[item]==="object"&&p2[item].__proto__!=Array.prototype){p[item]=loop(p1[item],p2[item])}else{if((typeof p1)!="undefined"&&(typeof p1[item])!="undefined"){p[item]=p1[item]}else{p[item]=p2[item]}}}return p})(p1,p2);return p};MyScroll.prototype.getClientHeight=function(){var clientHeight=0;if(document.body.clientHeight&&document.documentElement.clientHeight){var clientHeight=(document.body.clientHeight<document.documentElement.clientHeight)?document.body.clientHeight:document.documentElement.clientHeight}else{var clientHeight=(document.body.clientHeight>document.documentElement.clientHeight)?document.body.clientHeight:document.documentElement.clientHeight}return clientHeight};MyScroll.prototype.getScrollTop=function(){var scrollTop=0;if(document.documentElement&&document.documentElement.scrollTop){scrollTop=document.documentElement.scrollTop}else{if(document.body){scrollTop=document.body.scrollTop}}return scrollTop};MyScroll.prototype.getScrollHeight=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)};MyScroll.prototype.loadBar=function(){var config=this.config;var style="position: fixed;top: 0px;left: 0px;";style+="background-color: "+config.color+";height: "+config.height;var dom='<div id="progressBar" style="'+style+'"></div>';document.write(dom);if(config.debug){this.loadDebug()}};MyScroll.prototype.loadDebug=function(){var dom='<div id="debugShow" style="position: fixed;bottom:50px;background:rgba(0,0,0,0.7);border-radius:5px;padding:20px;color:#fff">⚝</div>';document.write(dom)};MyScroll.prototype.checkEvent=function(){event=this.event;if(!isEmpty(event)){this.filterEvent()}};MyScroll.prototype.filterEvent=function(){event=this.event;var preHeight=this.preHeight;var nextHeight=this.nextHeight;for(var e in event){var value=event[e];var index=(value.height||"0").indexOf("px");var type=value.type?value.type:"up-down";var height=0;var totalHeight=0;if(index!=-1){height=value.height.substring(0,index)}else{totalHeight=this.getScrollHeight()-this.getClientHeight()}var isConfirm=false;if(value.el){if(isInViewPort(value.el,height)){isConfirm=true}}else{if(type=="up-down"||type=="all"){if(height&&preHeight<height&&nextHeight>=height){isConfirm=true}else{if(totalHeight&&(preHeight/totalHeight).toFixed(2)<toPoint(value.height)&&(nextHeight/totalHeight).toFixed(2)>=toPoint(value.height)){isConfirm=true}}}if(type=="down-up"||type=="all"){if(height&&preHeight>height&&nextHeight<=height){isConfirm=true}else{if(totalHeight&&(preHeight/totalHeight).toFixed(2)>toPoint(value.height)&&(nextHeight/totalHeight).toFixed(2)<=toPoint(value.height)){isConfirm=true}}}}if(isConfirm){value.func();if(!value.loop){delete this.event[e]}}}};function isEmpty(obj){for(var name in obj){return false}return true}function toPoint(percent){var str=percent.replace("%","");str=str/100;return str}function isInViewPort(el,height){el=getSelector(el);const viewPortHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;const top=el.getBoundingClientRect()&&el.getBoundingClientRect().top;return top<=viewPortHeight-height}function getSelector(el){if(el instanceof Node){return el}else{if(typeof el=="string"){return document.querySelector(el)}else{console.warn("[MyScroll] warn Invalid element",el)}}}window.MyScroll=MyScroll})(window);